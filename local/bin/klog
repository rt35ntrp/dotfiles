#!/usr/bin/env bash
# klog: 현재 kube-context/namespace에서 stern으로 Pod 로그를 컬러로 팔로우
# 사용법: klog [pod-name-regex] [stern-추가옵션]
# 예시   klog api-      # api- 로 시작하는 모든 Pod 로그
#         klog . -c app  # 모든 Pod 중 app 컨테이너만
set -e

# 현재 네임스페이스 가져오기 (설정 없으면 default)
NAMESPACE=$(kubectl config view --minify -o jsonpath='{..namespace}' 2>/dev/null || echo default)

PATTERN="${1:-.}"
if [ $# -gt 0 ]; then
  shift
fi

# stern 실행 (없으면 안내)
if ! command -v stern &>/dev/null; then
  echo "⚠️  stern 명령을 찾을 수 없습니다. setup.sh 로 설치했는지 확인하세요." >&2
  exit 1
fi

stern "$PATTERN" --namespace "$NAMESPACE" "$@" 